# 복제

- 복제란 네트워크로 연결된 여러 장비에 동일한 데이터의 복사본을 유지하는 것
- 복제가 필요한 여러 이유
    - 지리적으로 사용자와 가깝게 데이터를 유지해 지연시간 줄인다
    - 시스템의 일부에 장애가 발생해도 지속적으로 동작할 수 있게 해 가용성을 높인다
    - 읽기 질의를 제공하는 장비의 수를 확장해 읽기 처리량을 높인다
    
- 복제에서 모든 어려움은 복제된 데이터의 변경 처리에 있음
- 복제를 위한 인기 있는 알고리즘 세가지
    - 단일 리더(single-leader)
    - 다중 리더(multi-leader)
    - 리더 없는(leaderless)
    
- 복제는 오래된 주제(1970년대 연구된 이래로 원리는 많이 변하지 않음)
    - 네트워크의 근본적인 제약 조건이 그때와 같기 때문
    
    
## 리더와 팔로워

- 복제 서버(replica): DB의 복사본을 저장하는 노드
- 복제 서버에서 동일한 데이터를 유지하는 방법: DB의 모든 쓰기는 모든 복제 서버에서 처리된다.
    - 리더 기반 복제(leader-based replication)(또는 active/passive, master/slave): 이 문제를 위한 가장 일반적인 해결책
        - 리더(leader)(또는 master, primary): 복제 서버 중 하나를 지정
            - 데이터베이스 쓰기 시 리더에게만 요청 보내야함
            - 쓰기 요청 시 로컬 저장소에 새로운 데이터 기록
            - 이후 데이터 변경을 복제 로그(replication log)나 변경 스트림(change stream)의 일부로 팔로워에게 전송
        - 팔로워(follower)(또는 read replica, slave, secondary, hot standby): 리더 제외한 다른 복제 서버
            - 읽기 시 팔로워에게도 질의 가능
- 복제 모드 지원 
    - RDB: mysql, postgres(9.0부터) 등 
    - NoSQL: mongoDB, 에스프레소 등
    - 분산 메시지 브로커: Kafka, RabbitMQ 등
    
