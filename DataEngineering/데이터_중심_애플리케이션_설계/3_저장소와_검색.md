# 저장소와 검색

- 특정 작업부하(workload) 유형에서 좋은 성능을 내게끔 저장소 엔진을 조정하려면 저장소 엔진이 내부에서 수행된느 작업에 대해 대략적인 개념을 이해할 필요가 있다.
- 트랜잭션 작업부하게 맞춰 최적화된 저장소 엔진과, 분석을 위해 최적화된 엔진 간에는 큰 차이가 있음
- 이번 장에서는 관계형 DB, NoSQL DB에서 사용하는 저장소 엔진에 대해 설명
- 그리고 log structured, page-oriented 계열 저장소 엔진 검토

## 데이터베이스를 강력하게 만드는 데이터 구조
- 많은 데이터베이스는 내부적으로 추가 전용(append-only) 데이터 파일인 로그를 사용
    - 이 책에서 로그는 연속된 추가 전용 레코드를 의미
- 키-값 저장소에서 색인이 없으면 매번 키를 찾을 때 마다 전체 데이터베이스 파일을 처음부터 끝까지 스캔해야 한다
    - O(n) 검색 비용
- 색인
    - 일반적인 개념은 어떤 부가적인 메타데이터를 유지하는 것. 
    - 어떤 종류의 색인이라도 쓰기 속도를 느리게 만든다 
        - 이는 데이터 쓸 때마다 매번 색인도 갱신해야 하기 때문
        - 저장소 시스템에서의 트레이드 오프
            - 색인을 잘 선택하면 읽기 질의 속도가 올라가지만 모든 색인은 쓰기 속도를 떨어뜨린다
        - 개발자나 데이터베이스 관리자가 수동으로 적절 색인 선택해야 함.
    
- 해시 색인
    - 키-값 데이터의 색인은 보통 해시맵으로 구현한다. 
    - 예제처럼 단순히 파일에 추가하는 방식으로 데이터 저장소를 구성한다고 가정할 때 간단하게 가능한 색인 전략
        - 키를 데이터 파일의 바이트 오프셋에 매핑해 인메모리 해시 맵을 유지
        - 파일에 새로운 키-값 쌍 추가할 때 마다 방금 기록한 데이터의 오프셋 반영을 위해 해시맵 갱신 필요
        - 값을 조회 하려면 해시맵을 사용해 데이터 파일에서 오프셋을 찾아 해당 위치를 구하고 값을 읽는다.
        - 비트캐스크(리악의 기본 저장소 엔진)가 근본적으로 사용하는 방식


