# 데이터 모델과 질의 언어

- 데이터 모델은 소프트웨어가 어떻게 작성됐는지 뿐 아니라 해결하려는 문제를 어떻게 생각해야 하는지에 대해서도 지대한 영향
- 대부분의 app은 하나의 데이터 모델을 다른 데이터 모델 위에 계층을 둬서 만듬. (하드웨어 -> DB -> 데이터 구조 -> 애플리케이션)
- 각 계층의 핵심적인 문제는 데이터 모델을 표현하는 방법. ex) 데이터 구조는 JSON, XML, RDB 테이블, 그래프 모델 같은 범용 데이터 모델로 표현
- 이번 챕터는 다양한 범용 데이터 모델을 살펴본다. 

## 관계형 모델과 문서 모델
- 관계형 모델
  - 데이터는 관계로 구성되고 각 관계는 순서없는 튜플 모음이다.
  
- NoSQL의 탄생
  - 관계형 모델의 우위를 뒤집으려는 최신 시도
  - NoSQL 채택의 원동력
    - 대규모 데이터셋, 높은 쓰기 처리량 달성을 RDB보다 쉽게 할 수 있는 확장성
    - 상용 DB 보다 무료 오픈소스 소프트웨어에 대한 선호도 확산
    - 특수 질의 동작
    - RDB의 스키마 제한에 대한 불만과 더 동적이고 표현력 풍부한 데이터 모델에 대한 바람.
  
- 다중 저장소 지속성(polyglot persistence)
  - 한 사용 사례에 맞는 최적의 기술 선택은 또 다른 사용 사례에 맞는 최적의 선택과는 다를 수 있다.
  - 가까운 미래에는 RDB가 폭넓은 다양함을 가진 비관계형 데이터 스토어와 함께 사용될 것이다. 
  
- 객체 관계형 불일치
  - APP 코드와 데이터베이스 모델 객체 사이에 전환 계층이 필요 (= 임피던스 불일치)
  - ORM 프레임워크(하이버네이트 같은)는 전환계층의 boilerplate code 양을 줄이지만 모델 간 차이 완벽히 숨길 수 없다.
  
- one-to-many 관계
  - 하나의 객체에 여러개의 속성이 있을 수 있다. (ex. 사람들은 경력에 넣을 직업, 연락처, 학력 기간 등이 하나 이상이다.)
  - 표현 방법
    - 정규화 표현
      - 전통적인 SQL 모델에서 사용
      - 속성을 개별 테이블에 넣고, 외래 키로 객체 참조
      - multi table
    - 구조화된 데이터 타입(data type), XML 데이터 지원
      - SQL 표준 마지막 버전에서 지원
      - 단일 로우에 다중 값 저장 가능하고 문서 내 질의와 색인 가능
      - DB2, MS SQL, Postgresql 등 DB 마다 제각각 다양한 형태로 지원.
    - JSON, XML 문서로 부호화해 DB의 텍스트 컬럼에 저장
      - 애플리케이션이 구조와 내용을 해석
      - 부호화된 컬럼의 값을 질의하는데 DB 사용 불가
      - multi table 스키마보다 더 나은 지역성(locality)을 가진다. 
        - join 이나 다중 질의 없이 관련 정보가 한 곳에 있어 질의 하나로 충분
    
  - 트리구조로 표현된다. 
  
- 다대일과 다대다 관계
  - 컬럼 값을 id 형태로 저장
    - 장점
      - 프로필 간 일관된 스타일과 철자
      - 모호함 회피
      - 갱신이 편리(정치적 사건 등으로 도시 이름이 변경 되는 경우)
      - 현지화 지원 (보는 사람의 언어로 표시 가능)
      - 더 나은 검색
    - 중복의 문제
      - ID를 사용하는 경우 사람에게 의미 있는 정보는 한 곳에만 저장하고 그것을 참조하는 모든 것은 ID를 사용
      - 텍스트를 직접 저장한다면 그것을 사용하는 모든 레코드에서 사람을 의미하는 정보를 중복해서 저장한다.
    - 변경의 필요 없음
      - ID 자체는 의미가 없어서 변경할 필요가 없음. 즉 식별 정보는 변경해도 ID는 동일하게 유지할 수 있다
      - 정보가 중복돼 있으면 모든 중복항목을 변경해야 함
      - 이는 쓰기 오버헤드와 불일치 위험. 
      - 이런 중복을 제거하는 일이 DB 정규화 이면에 놓인 핵심 개념
  - 다대일(many-to-one)
    - 중복된 데이터 정규화 하려면 필요
    - 문서 모델에 적합하지 않음. 
      - 조인에 대한 지원이 약함
      - DB가 조인을 지원하지 않으면 DB에 대한 다중 질의를 만들어서 조인 흉내 내야 함. 
    - join-free 문서 모델에 적합하더라도 app에 기능을 추가하면서 점차 상호 연결되는 경향 있음.
    - 예
      - 추천서 작성 기능 추가 시, 각 추천서들(many)이 추천인(one)을 참조하는 것으로 추천인의 사진 이름 등이 같이 보여짐.
  
  
  

